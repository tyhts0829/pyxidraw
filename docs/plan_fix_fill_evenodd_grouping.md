# plan: fill の偶奇グルーピング誤判定（0/9 の穴が埋まる）を修正

問題概要
- XY 経路の `_build_evenodd_groups(...)` が「重心内包判定」に依存しており、
  外環と内環の重心が一致し双方が互いを内包と誤認するケース（同心ドーナツ状）がある。
- その結果 `containers` が相互包含となり、`is_outer = (len(containers[i]) % 2) == 0` が
  全部 False → `outer_indices=[]` → 各リング単独グループ化 → 内環も単独で塗られて穴が埋まる。

原因（ログ確証）
- 両リングの `centroid` が一致し、`containers[outer]=[inner]` かつ `containers[inner]=[outer]`。
- `outer_indices=[]` によりグループが `[[0], [1]]` の形で分裂（`src/effects/fill.py`）。

修正方針（最小変更）
1) 相互包含のタイブレークを導入（面積優先）
   - `containers[i]` 構築後、全ペア `(i,j)` で「相互包含」の場合、
     `abs(area[i]) >= abs(area[j])` なら「大きい方 i が親・小さい方 j が子」
     とみなし、`containers[i]` から `j` を除去（`i` が `j` に内包される誤りを修正）。
     逆の場合は `containers[j]` から `i` を除去。
   - その後に `is_outer`/`groups` を決定。

2) （任意）面積同値時のタイブレーク
   - 面積が等しい場合は符号（向き）や offset インデックスで安定化。

3) テスト追加
   - 同心ドーナツ（外環/内環）で `fill(remove_boundary=True)` を適用し、
     内環領域に中点を持つセグメント本数が 0 であることを検証。

4) デバッグログ
   - 既存の `PXD_FILL_DEBUG=1` でのログを維持（不具合時の診断用）。

作業手順（チェックリスト）
- [ ] `_build_evenodd_groups` に相互包含タイブレーク（面積優先）を実装
- [ ] 面積同値時のフォールバック（向き/インデックス）
- [ ] テスト追加（同心ドーナツの穴が埋まらない）
- [ ] 変更ファイルに限定して ruff/black/isort/mypy
- [ ] 追加テストと関連 fill テストを実行

備考
- 根本的には「重心点による包含判定」は外環の重心が内環に入る形状で破綻する。
  本修正は最小・堅実なタイブレークで現象を除去する。
  将来的には「多角形の包含」をより厳密に判定する（例: 局所的に頂点サンプルを使う）
  方向も検討可能だが、現時点では面積優先で十分に実用的。

