# shapes/polyhedron.py 立方体実装変更計画（辺 → 閉じた正方形 6 面）

目的

- `polyhedron(polygon_index=1)`（hexahedron/cube）のフォールバック実装を、12 本の辺ポリライン集合から「6 つの閉じた正方形面」のポリライン集合に揃える。
- `data/regular_polyhedron/hexahedron_vertices_list.npz` の表現（5 頂点 ×6 面）と整合させ、挙動と見た目を統一する。

スコープ

- 対象ファイル: `src/shapes/polyhedron.py`
- 主な対象関数: `_generate_simple_polyhedron` の `"hexahedron" / "cube"` 分岐
- 既存の頂点キャッシュ/npz ロード処理は維持し、フォールバック生成のみを変更する。

方針（設計レベル）

- キューブの頂点は現行どおり `(±0.5, ±0.5, ±0.5)` の 8 頂点を使用する。
- 1 面 = 1 本のポリラインとし、「始点を末尾に繰り返して閉じる」形で 5 頂点の配列を 6 本生成する。
- 面の頂点順は右ねじ方向などに厳密拘束は置かず、`data/regular_polyhedron/hexahedron_vertices_list.npz` に揃える（可能な限り既存データの並びに合わせる）。
- API シグネチャや `__param_meta__` は変更しない（`polygon_index` の意味は現行どおり）。

実装タスク（チェックリスト）

1. 現状仕様の再確認

- [x] `_generate_simple_polyhedron("hexahedron")` が「12 本の辺（2 頂点ポリライン）」を返していることをコメント含めて整理する。
- [x] `data/regular_polyhedron/hexahedron_vertices_list.npz` の配列形状（5×3 が 6 本）を確認し、「6 面 × 閉じた正方形」の前提を明文化する。
- [x] `Geometry.from_lines` が「各ポリラインをそのまま線分列として解釈する」ことを再確認し、閉じた面は頂点重複で表現する方針を明示する。

2. 立方体フォールバック実装の変更

- [x] `"hexahedron" / "cube"` 分岐内のコメントを、「辺の接続定義」から「面ごとの頂点ポリライン定義」に書き換える。
- [x] 既存の `vertices` 定義（8 頂点）はそのまま利用しつつ、各面を頂点インデックスで表現する `faces_indices`（例: `[[0, 1, 2, 3], ...]`）を定義する。
- [x] 各面インデックス列から、「始点を末尾に追加した 5 頂点の np.ndarray（dtype=float32）」を生成するヘルパ（内包表記または小さなローカル関数）に置き換える。
- [x] 戻り値を「6 本の面ポリライン配列リスト」とし、既存の hexahedron 以外の分岐には影響を与えないようにする。

3. データ/フォールバック間の整合性確認

- [ ] `data/regular_polyhedron` あり/なしの両ケースで `polyhedron(polygon_index=1)` を生成し、線本数・頂点数・バウンディングが大きく乖離していないことを確認する（npz の方がやや洗練されていても可）。
- [ ] 可能であれば、npz の各ポリラインとフォールバック生成結果の面ごとの頂点順を比較し、大きく異なる場合はどちらに合わせるか方針を決める。（頂点順は厳密一致不要という方針のため優先度低）
- [x] `polygon_index` が hexahedron 以外の値のときに挙動が変わっていないことを簡単なスモークテストで確認する。

4. 動作確認・品質チェック

- [ ] `sketch/251107.py` や `demo/01.py` で `G.polyhedron(polygon_index=1)` を使い、立方体が「面ごとの輪郭」として期待どおり描画されるか目視確認する。
- [x] 対象ファイル `src/shapes/polyhedron.py` に対して `ruff check --fix`, `black`, `isort`, `mypy` を実行し、警告/エラーが出ないことを確認する。
- [x] 関連テスト（例: `pytest -q -k polyhedron` または `pytest -q -m smoke`）を実行し、少なくとも既存テストがすべて通ることを確認する。

5. ドキュメント/設計同期

- [ ] `docs/spec/shapes.md` の `polyhedron` 説明に、「各面をポリライン 1 本として持つ」ことを簡潔に追記するか確認・更新する。
- [ ] `architecture.md` に polyhedron/正多面体の表現についての記述があれば、今回の変更と矛盾がないかを確認し、必要に応じて更新する（該当コード参照を明記）。
- [ ] 本チェックリストをもとに PR 説明文/変更概要を整理できるよう、気づきや補足事項をこのファイルに追記する。

要確認事項（ユーザーへの相談ポイント）

- 実装では「npz に揃える」方針としていますが、**フォールバック実装の頂点順序を npz と厳密に一致させるべきか**、それとも「見た目の一貫性があればよい」レベルでよいかを確認したい。；揃える必要なし
- hexahedron 以外の多面体（tetrahedron, octahedron, dodecahedron, icosahedron）についても、**将来的に「各面ポリライン表現」に揃えるリファクタを行うべきか**（今回のスコープ外としておくか）方針を決めたい。；一旦今回はスコープ外で
- 立方体の正規化スケール（現在は辺長 1 相当, 中心原点）のままで問題ないか、それとも「他の shapes との一貫性の観点から変更したい要望」があるか確認したい。；現状のままで。
