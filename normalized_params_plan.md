# 全パラメータ正規化（0.0–1.0 入力）実装計画

## 目的
shape/effect 全引数を 0.0〜1.0 で受け取り、内部でメタデータのレンジへ変換する統一仕様を導入する。CC/GUI/スクリプトすべてで同一スケールを扱い、利用者は割り当てのみ意識すれば良い状態にする。

## 実装ステップ
- [ ] 仕様整理
  - [ ] 現行 API が想定する値スケール（`main.py` などの使用例）と衝突する箇所を列挙
  - [ ] `__param_meta__` 未整備パラメータのリストアップ方針を決める（`tools/list_param_meta.py` 活用）
  - [ ] 未設定パラメータへ暫定フォールバック（0.0〜1.0）を適用するガイドラインを作成
- [ ] RangeHint 拡張
  - [ ] `RangeHint` に保持される min/max/step をレンジ変換の唯一情報源と見なし、欠損時の扱い（0.0〜1.0）を統一
  - [ ] 既存の `_layout.derive_range` 依存箇所を調査し、必要なら非推奨化/削除方針を策定
- [ ] 値変換レイヤの実装
  - [ ] `ParameterRuntime` に入力正規化フックを追加し、ユーザー引数をレンジ値へ変換
  - [ ] CC ほか外部入力（`ParameterWindowController.apply_overrides`）でも同じ変換関数を使用
  - [ ] bool/int/step の丸め、ベクターパラメータのコンポーネントごとの変換を統一
- [ ] API 互換性対応
  - [ ] 既存コードとの互換性を保つため、移行期間中のフラグ（例: 環境変数/設定で旧挙動を選択）を検討
  - [ ] サンプルコード（`main.py` 等）を新仕様に合わせて 0.0〜1.0 入力へ書き換え
- [ ] メタデータ整備
  - [ ] `__param_meta__` 未設定のパラメータを列挙し、デフォルトレンジの妥当性をレビュー
  - [ ] 必要に応じて effects/shapes へメタデータを追加
- [ ] テスト整備
  - [ ] ユニットテストで正規化ロジック（scalar/vector/bool/int）を検証
  - [ ] 統合テストで実際の shape/effect 呼び出しが期待レンジへ変換されることを確認
  - [ ] 旧挙動との互換モード（用意した場合）が維持されることを確認
- [ ] ドキュメント更新
  - [ ] `architecture.md` / `AGENTS.md` に新仕様とメタデータ記述方法を追記
  - [ ] 開発者向けガイド（`__param_meta__` の書き方、テスト手順）を整理

## オープン質問
- 互換モードはどの程度の期間・粒度で提供するべきか？
- GUI 側で表示する値（ユーザーに見せる数値）はスケール後か元の 0〜1 か？ 表示と制御が一致するよう調整が必要。
- CC/GUI/スクリプト以外の入力経路（将来の API や外部設定ファイル）がある場合、変換レイヤをどこに設置するか？

## 観測事項
- 現状の `ParameterRuntime` はシグネチャ由来のデフォルト値を用い、ユーザー入力をそのまま渡しているため、変換レイヤの挿入ポイントとして適している。
- ベクターパラメータでは各コンポーネントが独立したレンジを持てるため、メタデータ整備時に配列/タプルで min/max/step を指定できるよう周知が必要。
- 0〜1 入力化はテスト・メタデータ整備に大きな工数が掛かるため、段階的な投入計画（ex: effect → shape）を検討する余地がある。
