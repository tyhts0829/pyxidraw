# MIDI 終了時の GUI 永続化（CC 反映）計画

目的: MIDI 接続時にパラメータを調整した値を、ウィンドウ終了時に `data/gui/*.json` の GUI 永続化へ書き込み、次回 MIDI 未接続でも復帰できるようにする。

## チェックリスト
- [x] 閉じるフックの確認: 描画ウィンドウの close ハンドラ（`api.sketch.on_close` 付近）で永続化を呼べるポイントを特定する。
- [x] スナップショット取得方針: 終了直前の CC スナップショットをどう取得するか決める（例: `cc_snapshot_fn()` をそのまま使う）。
- [x] 保存ロジック: `extract_overrides(store, cc_snapshot)` を使って CC 適用後の値を得て、`save_overrides` に渡す経路を追加する。
- [ ] 非 MIDI 時の挙動確認: MIDI 未接続時は従来の GUI override のみ保存し、CC 適用はスキップする分岐を実装する。
- [ ] 動作確認: 実機で「MIDI ありで調整→閉じる→MIDI なしで起動」が保存値で復帰することを確認。
- [ ] 余計なデバッグログの削除/整理（必要に応じて）。

## メモ
- CC 専用の `data/cc/` は現状維持とし、GUI 永続化側に CC 適用後の値を併せて残すだけにする。
- 保存呼び出しは close フック 1 回に限定し、毎フレーム保存は避ける。
