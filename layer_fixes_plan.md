# Layer 修正計画（重複キー整合・LazyGeometry 二重 realize 解消）

## ゴール

- レイヤー名重複時の override キーを GUI/ワーカ双方で一致させ、全レイヤーに GUI 値が確実に届くようにする。
- レイヤー描画で LazyGeometry の `realize()` を 1 回に抑え、同一フレーム内での二重実体化をなくす。

## チェックリスト

- [ ] 重複レイヤー名のキー生成ロジックを GUI 側とワーカ側で統一する（suffix 付与規則も明示）。
- [ ] 既存の Descriptor/override ID との互換性を確認し、必要ならキー生成のテストや影響範囲を洗い出す。
- [ ] `LineRenderer.draw()` でレイヤー処理時に 1 回だけ LazyGeometry を実体化し、アップロードとスナップショットの両方で使い回すようにする（`_upload_geometry` シグネチャは維持）。
- [ ] 上記変更に伴うユニットテスト/既存テストの更新・追加が必要かを評価する（必要ならテスト追加）。

## 追加確認・懸念事項

- 既存の保存済み GUI override（`save_overrides`）とのキー互換性をどう扱うか要確認（互換を維持するか、migration/リセット方針にするか）。
  既存の保存済みのパラメータのことは無視していいよ。破壊的変更可能。クリーンな実装、不要な互換性を排除していこう。
