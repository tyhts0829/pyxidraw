# palette 統合計画（確認用ドラフト）

目的: `src/palette` のカラー生成コアをドメイン層として整理しつつ、API から `C` を提供し、新規 GUI ウィンドウでパラメータ操作できるようにする。ここでは実装前のチェックリストを提示する。

## やること（チェックリスト）
- [ ] 配置/責務の確定: `src/palette` は計算コア（L1）として維持し、UI 向け補助は `engine/ui/palette/` 側へ分離、公開面は `api/palette.py` から `C` を再エクスポートする構成で進める。
- [ ] API 設計: `C` オブジェクトのインターフェース（`__getitem__`, `__len__`, 更新フック、型/Docstring、スタブ生成対象）と初期化フローを定義する。
- [ ] アーキテクチャ定義更新: `architecture.md` と `tests/test_architecture.py` の LAYER_MAP に `palette` を追加し、依存規約を明文化する。
- [ ] データフロー設計: GUI 変更→パレット生成→ワーカー/描画への反映経路を決める（スナップショット共有 or パラメータランタイム連携）。
- [ ] GUI 実装方針: `engine/ui/palette` に新規ウィンドウ/コントローラを追加し、ラベル選択・色表示・エクスポート操作を定義。既存 Parameter GUI との共存/起動タイミングを設計。
- [ ] モジュール分割: `ui_helpers.py` 等 UI 寄りの機能を `engine/ui/palette` 側へ移すか再実装し、`src/palette` には純計算のみを残す。
- [ ] 公開 API/ドキュメント: `api/__init__.py`/`api/palette.py` への追加、使用例（draw 内での `C[0]` など）を README/USAGE に追記。
- [ ] テスト計画: API レベル（`C` のアクセス/更新）、アーキテクチャテスト、必要に応じて GUI 用の最小スモーク（オプショナル）を用意。
- [ ] スタブ同期: 公開 API 変更後に `tools/gen_g_stubs.py` 実行と同期テスト更新。

## 確認したいこと/未確定事項
- `C` は単一パレットを表す想定か、複数プリセット/スロット対応が必要か。
- GUI の起動契機: `run(..., enable_palette_gui=True)` のようなフラグ追加か、常時起動か。
- パレット状態の永続化や config 連携（保存/復元）を行うか。
- ワーカープロセスへの伝搬方式: 現行の ParameterRuntime を再利用するか、独立のスナップショットチャンネルを設けるか。
- 既存 `ui_helpers.py` を移動/再配置する際の互換性要件（外部コピー利用を想定している場合の扱い）。
