# レイヤー計画 追加タスクチェックリスト（提案）

- [ ] API 設計
  - [x] `L`（仮）API の最小インターフェース定義（レイヤー追加/色・太さ設定/並び操作）。
  - [x] 公開位置の決定（`api/__init__.py` への再輸出方針と命名確認）。
  - [ ] `E.style` 利用箇所を `L` に置き換える移行指針を整理。
- [ ] データモデル
  - [x] `Layer` 型の確定（色/太さ/Geometry/LazyGeometry/メタを保持、量子化ルールは既存ポリシー踏襲）。
  - [x] `StyledLayer` からの移行方針と互換ブリッジの要否判断。
- [ ] 互換/廃止戦略
  - [x] `E.style` 廃止のスケジュールとエラーメッセージ方針（即時エラーか警告か）。
  - [x] 既存スケッチに対する最低限の移行ガイド草案作成。
- [ ] Runtime 正規化
  - [x] `worker._normalize_to_layers` を新 Layer モデルに置換（Sequence/LazyGeometry/Geometry 返却規約の再定義）。
  - [x] `ParameterRuntime` とレイヤー登録の同期方法（初回固定 vs 動的）を固める。
- [ ] キャッシュ設計
  - [ ] レイヤー単位キャッシュ鍵の構造を決定（時間/cc 量子化の適用、形状署名の扱いを含む）。
  - [ ] 無効化条件と共有スコープ（フレーム間/パイプライン間）を整理。
- [ ] Renderer
  - [ ] `LineRenderer` のレイヤー描画/スナップショット挙動を新モデルに合わせて調整（粘着色・太さのリセット条件）。
  - [ ] CPU/GPU 側での色・太さ適用順序の確認と最適化ポイント洗い出し。
- [ ] G-code
  - [ ] レイヤー情報の保持/コメント出力の設計（ペン交換指示の表現をどうするかの方針決定）。
  - [ ] 実装範囲の線引き（今回スコープ外か最小対応を入れるか）を確定。
- [ ] テスト計画
  - [ ] レイヤー API 単体テスト（返却規約/キャッシュ鍵）と Renderer/Export 統合テストの追加範囲を列挙。
  - [ ] 既存テストの改修対象（`E.style` 使用テストなど）をリストアップ。

このチェックリストで進めてよいか確認をお願いします。*** End Patch spectator】!【functions.apply_patch to=functions.apply_patch ატ JSON_SCHEMA PomJSONҵаны## Test Input Reasoning
